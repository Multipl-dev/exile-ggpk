# exile-ggpk | Rust GGPK Library

Rust library for reading Path of Exile game data files (.ggpk, bundles, .dat/.dat64).
Forked from ggpk-explorer. GPL-3.0. Dependency of exile-vision.

## Quick Reference

| Need | Location |
|------|----------|
| Session state | @.asid/context/active-context.md |
| Project structure | This file + src/ layout below |
| Decisions | @.asid/context/decisions.log |
| Lessons | WEIR/LESSONS.md |
| Memory | .asid/context/memory.log |
| Format spec | exile-vision/.asid/specs/ggpk-format.md |

## Commands

```bash
# Build (requires C++17 toolchain for ooz FFI)
git submodule update --init   # required on fresh clone
cargo build
cargo test
cargo clippy -- -D warnings
cargo audit                   # security check before release
```

## Library Structure

```
src/
├── lib.rs          # Public API entry point
├── ggpk/           # Classic GGPK format (pre-3.11.2 PoE)
│   ├── reader.rs   # Memory-mapped file reading
│   ├── record.rs   # GGPK/PDIR/FILE/FREE record types
│   └── tree.rs     # Directory tree traversal
├── bundles/        # Modern bundle format (3.11.2+ PoE)
│   ├── bundle.rs   # Oodle-compressed bundle reading
│   ├── index.rs    # File index with hash resolution
│   └── cdn.rs      # CDN manifest parsing
├── dat/            # Game data tables (.dat/.dat64)
│   ├── reader.rs   # Binary format parser
│   └── schema.rs   # Schema definitions
└── ooz/            # FFI wrapper for C++ Oodle decompression
    ├── mod.rs      # Safe Rust wrapper
    └── sys.rs      # C bindings (generated by bindgen)
```

## Key Patterns

- Memory-mapped I/O (`memmap2`) — no large heap allocations for file reads
- Safe wrapper over `unsafe` FFI — ooz is only touched via `ooz::decompress()`
- Dual hash support: FNV1a (≤3.21.1) and MurmurHash64A (3.21.2+)
- `Result` everywhere — no `unwrap()`, no panics in library code

## Related Repos

- **exile-vision/** — Primary consumer of this library (`../exile-vision/`)
- **ASID/** — Methodology canonical (`../ASID/`)
